# ===============================================
# PRÁCTICA: INSTALACIÓN Y CONFIGURACIÓN DE ANSIBLE
# ===============================================

# --- 1. Instalar Ansible en la VM Server (Ubuntu) ---
sudo apt update && sudo apt install -y ansible sshpass
ansible --version   # Verifica que Ansible está instalado correctamente

# --- 2. Crear usuario ansible en Linux (server y cliente) ---
sudo adduser ansible                # Crea el usuario
sudo usermod -aG sudo ansible       # Lo añade al grupo sudo (permisos de admin)

# --- 3. Generar llaves SSH sin contraseña (en el servidor) ---
su - ansible
ssh-keygen -t rsa -b 4096           # Pulsar Enter en todas las opciones para dejar por defecto

# --- 4. Copiar llave pública al cliente Linux ---
ssh-copy-id ansible@<IP_CLIENTE_LINUX>


# --- 6. Crear archivo de inventario para Ansible ---
sudo nano /etc/ansible/hosts
# Contenido:
[linux]
linuxclient ansible_host=10.0.0.151 ansible_user=ansible

[win]
clientwin ansible_host=10.0.0.162

[win:vars]
ansible_connection=winrm
ansible_user=ansible
ansible_password=Michael@1!
ansible_port=5985
ansible_winrm_scheme=http
ansible_winrm_transport=basic
ansible_winrm_server_cert_validation=ignore



# --- 7. Probar conexión con módulo ping ---
ansible all -m ping     # Prueba a todos los hosts
ansible linux -m ping   # Solo grupo Linux
ansible win -m win_ping # Solo grupo Windows




Configuracion Windows:
# Crear usuario 'ansible' (si ya existe, cambiar la contraseña)
$Password = ConvertTo-SecureString "Michael@1!" -AsPlainText -Force
if (-not (Get-LocalUser -Name "ansible" -ErrorAction SilentlyContinue)) {
    New-LocalUser -Name "ansible" -Password $Password -FullName "Usuario Ansible" -Description "Cuenta para automatización"
} else {
    Set-LocalUser -Name "ansible" -Password $Password
}

# Agregar a 'Administradores'
Add-LocalGroupMember -Group "Administradores" -Member "ansible"

# Agregar a 'Usuarios de administración remota'
Add-LocalGroupMember -Group "Usuarios de administración remota" -Member "ansible"

# Cambiar la red llamada "Red" a tipo Privada (antes de configurar WinRM)
Set-NetConnectionProfile -Name "Red" -NetworkCategory Private

# Configurar WinRM en HTTP (puerto 5985) y permitir Basic + sin cifrado
winrm quickconfig -q
Set-Item -Path WSMan:\localhost\Service\AllowUnencrypted -Value $true
Set-Item -Path WSMan:\localhost\Service\Auth\Basic -Value $true

# Abrir el firewall para WinRM
netsh advfirewall firewall add rule name="WinRM HTTP" dir=in action=allow protocol=TCP localport=5985

# Reiniciar WinRM
Restart-Service WinRM









